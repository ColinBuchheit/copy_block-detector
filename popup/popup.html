<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>CopyBlock Detector</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      width: 320px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #333;
      overflow: hidden;
    }

    .container {
      background: white;
      margin: 0;
      border-radius: 0;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }

    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .header::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
      animation: shimmer 3s ease-in-out infinite;
    }

    @keyframes shimmer {
      0%, 100% { transform: translate(-50%, -50%) rotate(0deg); }
      50% { transform: translate(-50%, -50%) rotate(180deg); }
    }

    .header h1 {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 5px;
      position: relative;
      z-index: 1;
    }

    .header .subtitle {
      font-size: 12px;
      opacity: 0.9;
      position: relative;
      z-index: 1;
    }

    .content {
      padding: 20px;
    }

    .status-section {
      margin-bottom: 20px;
    }

    .status-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 15px;
    }

    .status-item {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 12px;
      text-align: center;
      border: 2px solid transparent;
      transition: all 0.3s ease;
    }

    .status-item.blocked {
      border-color: #ff6b6b;
      background: #ffe0e0;
    }

    .status-item.safe {
      border-color: #51cf66;
      background: #e0ffe0;
    }

    .status-item.warning {
      border-color: #ffd43b;
      background: #fff9e0;
    }

    .status-icon {
      font-size: 20px;
      margin-bottom: 5px;
      display: block;
    }

    .status-text {
      font-size: 11px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .main-status {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 20px;
      text-align: center;
      border: 2px solid #dee2e6;
    }

    .main-status.alert {
      background: linear-gradient(135deg, #ffe0e0 0%, #ffcccb 100%);
      border-color: #ff6b6b;
      color: #c92a2a;
    }

    .main-status.safe {
      background: linear-gradient(135deg, #e0ffe0 0%, #ccffcc 100%);
      border-color: #51cf66;
      color: #2b8a3e;
    }

    .main-status-icon {
      font-size: 24px;
      margin-bottom: 8px;
      display: block;
    }

    .main-status-text {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .main-status-detail {
      font-size: 12px;
      opacity: 0.8;
    }

    .action-button {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .action-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    }

    .action-button:active {
      transform: translateY(0);
    }

    .action-button:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .action-button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }

    .action-button:hover::before {
      left: 100%;
    }

    .settings-section {
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid #dee2e6;
    }

    .settings-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .settings-label {
      font-size: 12px;
      color: #666;
    }

    .toggle-switch {
      position: relative;
      width: 44px;
      height: 24px;
      background: #ccc;
      border-radius: 12px;
      cursor: pointer;
      transition: background 0.3s;
    }

    .toggle-switch.active {
      background: #667eea;
    }

    .toggle-switch::after {
      content: '';
      position: absolute;
      top: 2px;
      left: 2px;
      width: 20px;
      height: 20px;
      background: white;
      border-radius: 50%;
      transition: transform 0.3s;
    }

    .toggle-switch.active::after {
      transform: translateX(20px);
    }

    .loading {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid #f3f3f3;
      border-top: 2px solid #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-right: 8px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .fade-in {
      animation: fadeIn 0.5s ease-in;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .pulse {
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    .quick-actions {
      display: flex;
      gap: 8px;
      margin-top: 12px;
    }

    .quick-action-btn {
      flex: 1;
      padding: 8px;
      background: rgba(102, 126, 234, 0.1);
      border: 1px solid rgba(102, 126, 234, 0.3);
      border-radius: 6px;
      font-size: 11px;
      color: #667eea;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .quick-action-btn:hover {
      background: rgba(102, 126, 234, 0.2);
      border-color: #667eea;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üõ°Ô∏è CopyBlock Detector</h1>
      <div class="subtitle">Privacy & Copy Protection</div>
    </div>
    
    <div class="content">
      <div class="main-status" id="mainStatus">
        <span class="main-status-icon">üîç</span>
        <div class="main-status-text">Analyzing Page...</div>
        <div class="main-status-detail">Checking for copy restrictions</div>
      </div>

      <div class="status-section">
        <div class="status-grid">
          <div class="status-item" id="cssStatus">
            <span class="status-icon">üé®</span>
            <div class="status-text">CSS Block</div>
          </div>
          <div class="status-item" id="jsStatus">
            <span class="status-icon">‚ö°</span>
            <div class="status-text">JS Block</div>
          </div>
          <div class="status-item" id="trackingStatus">
            <span class="status-icon">üëÅÔ∏è</span>
            <div class="status-text">Tracking</div>
          </div>
          <div class="status-item" id="contextStatus">
            <span class="status-icon">üñ±Ô∏è</span>
            <div class="status-text">Context Menu</div>
          </div>
        </div>
      </div>

      <button class="action-button" id="enableCopyBtn">
        <span id="buttonText">Enable Copy</span>
        <span class="loading" id="buttonLoading" style="display: none;"></span>
      </button>

      <div class="quick-actions">
        <button class="quick-action-btn" id="whitelistBtn">Whitelist Site</button>
        <button class="quick-action-btn" id="settingsBtn">Settings</button>
      </div>

      <div class="settings-section">
        <div class="settings-row">
          <span class="settings-label">Auto-enable on detection</span>
          <div class="toggle-switch" id="autoToggle"></div>
        </div>
        <div class="settings-row">
          <span class="settings-label">Show notifications</span>
          <div class="toggle-switch active" id="notifyToggle"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    class PopupUI {
      constructor() {
        this.elements = {
          mainStatus: document.getElementById('mainStatus'),
          cssStatus: document.getElementById('cssStatus'),
          jsStatus: document.getElementById('jsStatus'),
          trackingStatus: document.getElementById('trackingStatus'),
          contextStatus: document.getElementById('contextStatus'),
          enableBtn: document.getElementById('enableCopyBtn'),
          buttonText: document.getElementById('buttonText'),
          buttonLoading: document.getElementById('buttonLoading'),
          autoToggle: document.getElementById('autoToggle'),
          notifyToggle: document.getElementById('notifyToggle'),
          whitelistBtn: document.getElementById('whitelistBtn'),
          settingsBtn: document.getElementById('settingsBtn')
        };
        
        this.currentStatus = null;
        this.currentTab = null;
        this.init();
      }

      init() {
        this.getCurrentTab();
        this.setupEventListeners();
        this.loadSettings();
        this.requestStatus();
      }

      getCurrentTab() {
        chrome.tabs.query({ active: true, currentWindow: true }, (tabs) => {
          this.currentTab = tabs[0];
        });
      }

      setupEventListeners() {
        this.elements.enableBtn.addEventListener('click', () => this.enableCopy());
        this.elements.autoToggle.addEventListener('click', () => this.toggleSetting('autoEnable'));
        this.elements.notifyToggle.addEventListener('click', () => this.toggleSetting('showNotifications'));
        this.elements.whitelistBtn.addEventListener('click', () => this.addToWhitelist());
        this.elements.settingsBtn.addEventListener('click', () => this.openSettings());

        // Listen for status updates
        chrome.runtime.onMessage.addListener((msg) => {
          if (msg.type === 'DETECTION_COMPLETE' || msg.type === 'DETECTION_UPDATE') {
            this.updateStatus(msg.results);
          } else if (msg.type === 'COPY_ENABLED') {
            this.showSuccess(msg.message);
          }
        });
      }

      requestStatus() {
        if (!this.currentTab) {
          setTimeout(() => this.requestStatus(), 100);
          return;
        }

        chrome.tabs.sendMessage(this.currentTab.id, { type: 'GET_STATUS' }, (response) => {
          if (chrome.runtime.lastError) {
            // Content script not ready or page doesn't support it
            this.showError('Unable to analyze this page');
            return;
          }
          
          if (response) {
            this.updateStatus(response);
          }
        });
      }

      updateStatus(results) {
        this.currentStatus = results;
        
        // Update individual status items
        this.updateStatusItem('cssStatus', results.cssBlocking);
        this.updateStatusItem('jsStatus', results.jsBlocking);
        this.updateStatusItem('trackingStatus', results.copyTracking || results.pasteTracking);
        this.updateStatusItem('contextStatus', results.contextMenuBlocked);

        // Update main status
        const hasBlocking = Object.values(results).some(blocked => blocked);
        this.updateMainStatus(hasBlocking, results);
      }

      updateStatusItem(elementId, isBlocked) {
        const element = this.elements[elementId];
        element.className = 'status-item ' + (isBlocked ? 'blocked' : 'safe');
        element.classList.add('fade-in');
      }

      updateMainStatus(hasBlocking, results) {
        const mainStatus = this.elements.mainStatus;
        
        if (hasBlocking) {
          mainStatus.className = 'main-status alert pulse';
          mainStatus.innerHTML = `
            <span class="main-status-icon">‚ö†Ô∏è</span>
            <div class="main-status-text">Restrictions Detected</div>
            <div class="main-status-detail">This page blocks copy/paste or tracks your actions</div>
          `;
        } else {
          mainStatus.className = 'main-status safe';
          mainStatus.innerHTML = `
            <span class="main-status-icon">‚úÖ</span>
            <div class="main-status-text">Page is Safe</div>
            <div class="main-status-detail">No copy restrictions or tracking detected</div>
          `;
        }
      }

      showError(message) {
        const mainStatus = this.elements.mainStatus;
        mainStatus.className = 'main-status';
        mainStatus.innerHTML = `
          <span class="main-status-icon">‚ùå</span>
          <div class="main-status-text">Analysis Failed</div>
          <div class="main-status-detail">${message}</div>
        `;
      }

      enableCopy() {
        if (!this.currentTab) return;
        
        this.showLoading();
        chrome.tabs.sendMessage(this.currentTab.id, { type: 'ENABLE_COPY' });
      }

      showLoading() {
        this.elements.buttonText.style.display = 'none';
        this.elements.buttonLoading.style.display = 'inline-block';
        this.elements.enableBtn.disabled = true;
      }

      showSuccess(message) {
        this.elements.buttonLoading.style.display = 'none';
        this.elements.buttonText.textContent = '‚úÖ Success!';
        this.elements.buttonText.style.display = 'inline';
        this.elements.enableBtn.disabled = false;
        
        setTimeout(() => {
          this.elements.buttonText.textContent = 'Enable Copy';
        }, 2000);
      }

      addToWhitelist() {
        if (!this.currentTab) return;
        
        const domain = new URL(this.currentTab.url).hostname;
        chrome.runtime.sendMessage({
          type: 'ADD_TO_WHITELIST',
          domain: domain
        });
        
        this.elements.whitelistBtn.textContent = '‚úÖ Added';
        setTimeout(() => {
          this.elements.whitelistBtn.textContent = 'Whitelist Site';
        }, 2000);
      }

      openSettings() {
        chrome.runtime.openOptionsPage();
      }

      toggleSetting(setting) {
        const toggle = this.elements[setting === 'autoEnable' ? 'autoToggle' : 'notifyToggle'];
        toggle.classList.toggle('active');
        
        // Get current settings and update
        chrome.runtime.sendMessage({ type: 'GET_SETTINGS' }, (settings) => {
          settings[setting] = toggle.classList.contains('active');
          chrome.runtime.sendMessage({ 
            type: 'UPDATE_SETTINGS', 
            settings: settings 
          });
        });
      }

      loadSettings() {
        chrome.runtime.sendMessage({ type: 'GET_SETTINGS' }, (settings) => {
          if (settings) {
            if (settings.autoEnable) this.elements.autoToggle.classList.add('active');
            if (settings.showNotifications) this.elements.notifyToggle.classList.add('active');
          }
        });
      }
    }

    // Initialize popup
    document.addEventListener('DOMContentLoaded', () => {
      new PopupUI();
    });
  </script>
</body>
</html>